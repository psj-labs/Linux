# Virtual Host_02

## 개요

- 본 문서는 Apache VirtualHost 기능과 DNS(Name Server)를 연동하여  
  하나의 서버, 하나의 IP에서 여러 도메인을 기반으로 웹 서비스를 제공하는 과정을 정리한 학습 문서입니다.
- Apache의 Name 기반 VirtualHost 구성과  
  BIND(named)를 이용한 도메인 네임서버 구성을 함께 실습합니다.
- 디렉터리 및 Apache 기본 설치는 `01. Apache Server` 구축에서 다루었습니다.

---

## 네트워크 구성

- 다음과 같은 구성으로 실습을 진행합니다.  
![40](/Apache%20서버/imgs/40.png)

- DNS 서버 : 192.168.0.54  
- Web 서버 : 192.168.0.55  

- www.ast10.sec → 192.168.0.55  
- www.ast10.itc → 192.168.0.55  

- 두 도메인은 동일한 IP를 사용합니다.

---

## DNS 서버 구성

- 다음은 `/etc/named.conf` 파일입니다.

![30](/Apache%20서버/imgs/30.png)


- ast10.sec와 ast10.itc 도메인을 각각 master zone으로 설정합니다.

---

## ast10.sec의 Zone 파일

- 파일 위치 : `/var/named/ast10.sec.zone`

![31](/Apache%20서버/imgs/31.png)

- 네임서버 IP는 192.168.0.54로 설정합니다.
- `ast10.sec` 및 `www.ast10.sec`의 호스트 IP는  
  192.168.0.55로 설정합니다.

---

## ast10.itc의 Zone 파일

- 파일 위치 : `/var/named/ast10.itc.zone`

![32](/Apache%20서버/imgs/32.png)

- 네임서버 IP는 192.168.0.54로 설정합니다.
- `ast10.itc` 및 `www.ast10.itc`의 호스트 IP는  
  192.168.0.55로 설정합니다.

---

## named 서비스 실행

- 다음 명령어로 DNS 서비스를 실행합니다.

```
systemctl start named
```

![33](/Apache%20서버/imgs/33.png)

---

## Apache VirtualHost 설정

- httpd.conf에서 VirtualHost 설정 파일을 include 합니다.

```
Include conf/extra/httpd-vhosts.conf
```

![34](/Apache%20서버/imgs/34.png)

---

## httpd-vhosts.conf 설정

- 다음 파일에 VirtualHost 설정을 작성합니다.

```
/app/apache/conf/extra/httpd-vhosts.conf
```

![35](/Apache%20서버/imgs/35.png)

```
NameVirtualHost *:80

<VirtualHost *:80 >
DocumentRoot /home/httpd/sec
ServerName www.ast10.sec
ServerAlias ast10.sec
</VirtualHost>

<VirtualHost *:80 >
DocumentRoot /home/httpd/itc
ServerName www.ast10.itc
ServerAlias ast10.itc
</VirtualHost>
```

### VirtualHost 설정 의미

- `NameVirtualHost *:80`  
  → 80번 포트로 들어오는 요청을 도메인 이름 기준으로 구분합니다.

- 첫 번째 VirtualHost  
  → www.ast10.sec 또는 ast10.sec로 접속 시  
  `/home/httpd/sec` 디렉토리를 제공합니다.

- 두 번째 VirtualHost  
  → www.ast10.itc 또는 ast10.itc로 접속 시  
  `/home/httpd/itc` 디렉토리를 제공합니다.

- 즉, 같은 IP이지만 도메인 이름에 따라 서로 다른 웹 페이지를 제공합니다.

---

## Apache 서버 실행

- 다음 명령어로 Apache 서버를 구동합니다.

```
/app/apache/bin/apachectl start
```

---

## 클라이언트 DNS 설정

- 클라이언트의 DNS 서버를 네임서버 IP인  
  `192.168.0.54`로 설정합니다.

![36](/Apache%20서버/imgs/36.png)

---

## DNS 동작 확인

- nslookup으로 도메인 질의를 수행합니다.

![37](/Apache%20서버/imgs/37.png)

- 두 도메인 모두 동일한 IP(192.168.0.55)로 응답하는 것을 확인할 수 있습니다.

---

## 접속 테스트

- www.ast10.sec 접속

![38](/Apache%20서버/imgs/38.png)

- www.ast10.itc 접속

![39](/Apache%20서버/imgs/39.png)

- 두 도메인 모두 동일한 서버 IP를 사용하지만  
  각 VirtualHost에 맞는 페이지가 정상적으로 출력됩니다.

---

## 정리

- 하나의 IP에 여러 도메인을 쓰는 것은 IP 자원을 절약하고 서버 자원을 효율적으로 사용하기 위함입니다.
- DNS는 도메인을 동일한 IP로 매핑합니다.
- Apache는 Host Header를 기준으로 VirtualHost를 선택합니다.
