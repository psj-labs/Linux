# Apache Server 구축

## 개요

- 본 문서는 Linux 환경에서 Apache HTTP Server를 소스 컴파일 방식으로 설치하고 기본 설정을 진행하는 과정을 정리한 학습 문서입니다.
- Apache의 주요 구성 파일과 동작 구조를 확인하고, DocumentRoot 변경 및 권한 분리를 통해 웹 서버 운영 구조를 이해합니다.
- 또한 Web 서버 관리와 Web 페이지 관리의 역할을 분리하여 보안적인 구조를 구성합니다.

---

## Apache 설치

- 다음 과정으로 Apache를 설치합니다.
```
dnf install -y gcc gcc-c++ cmake apr apr-util zlib-devel wget net-tools expat-devel  
wget https://archive.apache.org/dist/httpd/httpd-2.2.34.tar.gz  
tar xvfz httpd-2.2.34.tar.gz  
cd ./httpd-2.2.34  
./configure --prefix=/app/apache --enable-so  
make  
make install  
```
---

## Apache 주요 구성 파일

- Apache 설치 후 주요 구성 파일은 다음과 같습니다.
```
실행 데몬 : /app/apache/bin/httpd  
관리 스크립트 : /app/apache/bin/apachectl  
설정 파일 : /app/apache/conf/httpd.conf  
기본 페이지 파일 : /app/apache/htdocs/index.html  
실제 경로는 컴파일 옵션에 따라 달라질 수 있습니다.
```

---

## Apache 서버 구동

- Apache 서버를 구동합니다.

```
/app/apache/bin/apachectl start  
```
![01](/Apache%20서버/imgs/01.png)

---

## 기본 페이지 확인

- Apache 서버가 구동되면 다음 경로에 기본 index.html 파일이 존재합니다.

![02](/Apache%20서버/imgs/02.png)

- Apache 서버를 구동한 IP 주소로 접속하면 기본 페이지가 출력됩니다.

![03](/Apache%20서버/imgs/03.png)

---

## DocumentRoot 변경

- DocumentRoot란 웹 브라우저에서 요청한 URL에 대해 실제 웹 문서를 제공하는 기준 디렉토리를 의미합니다.
- 즉, 웹 서버가 외부 요청에 대해 파일을 제공하는 최상위 디렉토리입니다.

- 필자는 DocumentRoot 경로를 다음과 같이 변경합니다.
```
/home/httpd/html  
```
- DocumentRoot와 함께 Directory 설정 경로도 동일하게 수정합니다.

![04](/Apache%20서버/imgs/04.png)

---

## ServerName 설정

- Apache가 자기 자신을 식별할 기준 호스트명을 지정하여 안정적으로 동작하게 만들기 위해 ServerName을 설정합니다.

![localhost](/Apache%20서버/imgs/localhost.png)

---

## DocumentRoot 디렉토리 생성

- 실제 경로가 존재해야 하므로 다음과 같이 디렉토리와 index.html 파일을 생성합니다.
```
mkdir -p /home/httpd/html  
echo test > /home/httpd/html/index.html  
```
- Apache 서버를 재시작합니다.
```
/app/apache/bin/apachectl restart  
```
![05](/Apache%20서버/imgs/05.png)

- 변경된 페이지가 정상적으로 출력되는 것을 확인합니다.

![06](/Apache%20서버/imgs/06.png)

---

## httpd.conf 구문 점검

- 설정 파일의 문법 오류를 점검합니다.
```
/app/apache/bin/httpd -t  
```
- “Syntax OK”가 출력되면 문법 오류가 없음을 의미합니다.

---

## httpd.conf 주요 설정 항목

### ServerRoot "/app/apache"  
- Apache 설정 파일과 로그 파일이 저장되는 최상위 디렉토리입니다.

### Timeout 120  
- 클라이언트와 통신이 없을 경우 오류로 처리되는 시간(초)입니다.

### MaxClients 150  
- 동시에 접속 가능한 최대 클라이언트 수입니다.

### StartServers 20  
- 초기 서버 프로세스 수입니다.

### MinSpareServers / MaxSpareServers  
- 대기 상태의 서버 프로세스 수입니다.

### ServerName  
- DNS 또는 hosts 파일에 등록된 Apache 서버의 이름입니다.

### DocumentRoot "/app/apache/htdocs"  
- 웹 서버의 기본 홈 디렉토리입니다.

### DirectoryIndex index.html index.java index.php  
- 메인 페이지로 인식되는 파일 이름입니다.

### ErrorLog logs/error_log  
- 서버 오류 발생 시 기록되는 로그 파일입니다.

### CustomLog logs/access_log combined  
- 클라이언트 접근 기록을 저장하는 로그 파일입니다.

### UserDir public_html  
- 사용자 홈 디렉토리 기반 웹 서비스 설정입니다.

### ServerAdmin root@localhost  
- 서버 관리자 이메일 주소입니다.

---

## Directory 설정

- Apache는 디렉토리 단위로 접근 제어를 수행합니다.

#### 예시
```
<Directory "/app/apache/htdocs">
Options Indexes FollowSymLinks
AllowOverride None
IndexOptions Charset=UTF-8
Order allow,deny
Allow from all
</Directory>
```
---

## Options 항목

- ALL : 모든 옵션 허용  
- None : 모든 옵션 비활성화  
- Indexes : index 파일이 없을 경우 디렉토리 목록 표시  
- FollowSymLinks : 심볼릭 링크 허용  
- ExecCGI : CGI 실행 허용  

---

## IndexOptions 항목

- Charset=UTF-8 : 디렉토리 및 파일명을 UTF-8로 인코딩합니다.

---

## AllowOverride 항목

- .htaccess 파일 사용 여부를 결정합니다.  
- Apache 레벨에서 접근 제어를 수행할지 여부를 의미합니다.

---

## 접근 제어 설정 (Apache 2.2)
```
Order deny,allow  
Deny from all  
Allow from 192.168.123.  
```
- 192.168.123.으로 시작하는 IP만 접속을 허용합니다.

---

## 역할 분리 원칙

- HTTPD 서버 관리와 Web 페이지 관리는 반드시 분리 구성합니다.
- Web 페이지 관리자는 시스템 디렉토리에 접근해서는 안 됩니다.
- Web 페이지 전용 계정을 생성하여 홈 디렉토리 내에서만 작업하도록 구성합니다.

### 관리자 정보  

- 계정 : webmaster (group:web)  
- DocumentRoot : /home/httpd/html  

---

## 그룹 및 사용자 생성
```
groupadd -g 5000 web  
useradd -g 5000 -u 5001 webmaster  
```
![07](/Apache%20서버/imgs/07.png)

---

## 퍼미션 설정

- webmaster가 자유롭게 수정할 수 있도록 소유자를 변경합니다.
```
chown -R webmaster.web /home/httpd  
```
![08](/Apache%20서버/imgs/08.png)

---

## 마운트 설정

- webmaster는 직접 `/home/httpd/html`에 접근하지 않으므로 마운트를 통해 접근 경로를 제공합니다.

- webmaster 계정에서 작업할 디렉토리를 생성합니다.
```
mkdir -p /home/webmaster/httpd  
```
![09](/Apache%20서버/imgs/09.png)

- root 계정으로 돌아가 다음과 같이 바인드 마운트를 수행합니다.
```
mount -B /home/httpd /home/webmaster/httpd  
```
![10](/Apache%20서버/imgs/10.png)

---

## 웹 페이지 수정 및 확인

- webmaster 계정에서 확인 시 기존 index.html 파일이 자동으로 동기화되어 출력됩니다.

![11](/Apache%20서버/imgs/11.png)

- webmaster 계정에서 페이지 내용을 수정합니다.

![12](/Apache%20서버/imgs/12.png)

- 브라우저에서 다시 페이지를 로드하면 수정된 내용이 정상적으로 출력됩니다.

![13](/Apache%20서버/imgs/13.png)

---

## 정리

- Apache는 소스 컴파일 방식으로 설치할 수 있으며, 설치 경로를 직접 지정할 수 있습니다.
- DocumentRoot는 웹 서버가 외부 요청에 대해 파일을 제공하는 기준 디렉토리입니다.
- ServerName 설정은 Apache의 안정적인 동작을 위해 필요합니다.
- httpd.conf 설정 오류는 httpd -t 명령어로 사전에 점검할 수 있습니다.
- Web 서버 관리와 Web 페이지 관리는 계정과 권한을 분리하여 구성해야 합니다.
- 바인드 마운트를 이용하면 보안을 유지하면서 웹 페이지 관리가 가능합니다.
