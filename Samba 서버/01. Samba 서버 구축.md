# Samba 서버 구축

## 개요

- Samba는 네트워크를 통해 디렉터리(파일 시스템)를 공유하도록 제공하는 서비스입니다.
- 유닉스 계열 시스템과 Windows 시스템 간 파일 시스템 공유를 지원합니다.
- 유닉스 계열의 거의 모든 시스템에서 제공됩니다.
- 응용 프로그램을 제공하는 것이 아니라 시스템의 리소스를 직접 제공하는 서비스이므로 보안 설정에 주의해야 합니다.

---

## Samba 패키지 설치

- 다음 명령어로 Samba 서버를 설치합니다.
```
dnf install -y samba
```
![01](/Samba%20서버/imgs/01.png)

---

## Samba 주요 구성 요소

- `/usr/sbin/smbd` 
  파일 공유 기능을 담당하는 데몬이며 TCP 139, 445 포트를 사용합니다.

- `/usr/lib/systemd/system/smb.service`  
  smbd 데몬을 제어하는 systemd 서비스 파일입니다.

- `/etc/samba/smb.conf`  
  Samba 서버의 동작을 정의하는 환경 설정 파일입니다.

---

## Samba 관련 명령어

- `smbpasswd`  
  Samba 사용자 등록 및 비밀번호를 관리합니다.  
  -a : 사용자 추가  
  -x : 사용자 삭제  
  -d / -e : 사용자 비활성화 / 활성화  

- `pdbedit -wL`  
  Samba 사용자 데이터베이스에 등록된 계정 목록을 확인합니다.

- `testparm`
  smb.conf 파일의 문법 오류를 검사합니다.

- `nmblookup`  
  NetBIOS 이름 해석을 수행합니다.

---

## Samba 사용자 등록

- Samba 사용자는 Linux 계정과 별도로 관리됩니다.
- 다음 명령어로 Samba 계정을 등록합니다.
```
smbpasswd -a ast10
```
![02](/Samba%20서버/imgs/02.png)

- 다음 명령어로 Samba 사용자 목록을 확인합니다.
```
pdbedit -wL
```
![03](/Samba%20서버/imgs/03.png)

- ast10 사용자가 정상적으로 등록된 것을 확인할 수 있습니다.

---

## 공유 디렉터리 생성 및 권한 설정

- 공유에 사용할 디렉터리를 생성합니다.
```
mkdir /home/data
```
- 파일 생성, 수정, 삭제 실습을 위해 퍼미션을 777로 설정합니다.
```
chmod -R 777 /home/data
```
![04](/Samba%20서버/imgs/04.png)

---

## smb.conf [global] 주요 옵션 설명

- `workgroup`  
  Windows 네트워크에서 사용할 워크그룹 또는 NT 도메인 이름을 지정합니다.

- `netbios name`  
  네트워크 상에서 Samba 서버를 식별할 이름을 지정합니다.  
  지정하지 않으면 호스트명이 기본값으로 사용됩니다.

- `hosts allow / hosts deny`  
  Samba 서버에 접근 가능한 클라이언트를 제한합니다.

- `guest account`  
  Windows의 guest 사용자를 Linux 계정으로 매핑합니다.  
  일반적으로 nobody 계정을 사용하며, 주석 처리 시 guest 접속은 차단됩니다.

- `security = user`  
  사용자 인증 기반 접근 제어를 사용합니다.

- `passdb backend = tdbsam`  
  Samba 사용자 정보를 tdb 데이터베이스에 저장합니다.

---

## 심볼릭 링크 접근 관련 옵션

- `follow symlinks = yes`  
  심볼릭 링크를 따라 디렉터리에 접근할 수 있도록 허용합니다.

- `wide links = yes`  
  공유 디렉터리 외부를 가리키는 심볼릭 링크 접근을 허용합니다.

- `unix extensions = no`  
  Unix 확장 기능을 비활성화하여 Windows 클라이언트 접근 제한을 해제합니다.

---

## smb.conf [Share] 주요 옵션 설명

- `path = /home/data`  
  실제 공유할 디렉터리 경로를 지정합니다.

- `browseable = yes / no`  
  네트워크 탐색기에 공유 목록을 표시할지 여부를 지정합니다.

- `writable = yes`  
  공유 디렉터리에 대한 쓰기 접근을 허용합니다.

- `read only = yes`  
  기본적으로 읽기 전용으로 접근을 제한합니다.

- `public = yes / no`  
  인증 없이 접근을 허용할지 여부를 지정합니다.

- `valid users = ast10`  
  접근 가능한 사용자를 제한합니다.

- `write list = +test ast10`  
  쓰기 권한을 허용할 사용자 또는 그룹을 지정합니다.

- `inherit acls = yes`  
  상위 디렉터리의 ACL 권한을 하위 파일과 디렉터리에 상속합니다.

--- 

## [homes] 공유 설명

- [homes]는 Samba에서 기본 제공하는 공유입니다.
- 각 사용자의 홈 디렉터리를 자동으로 공유합니다.
- 사용자는 자신의 홈 디렉터리에만 접근할 수 있습니다.

---

### `etc/samba/smb.conf` 파일 설정

- 다음과같이 환경설정 파일을 구성합니다.
![05](/Samba%20서버/imgs/05.png)


## Samba 서버 실행

- 다음 명령어로 Samba 서버를 구동합니다.
```
systemctl start smb
```
![06](/Samba%20서버/imgs/06.png)

---

## Windows 클라이언트 접근 확인

- Windows 탐색기에서 다음 경로로 접근합니다.
```
\\192.168.10.147
```
- 설정한 공유 디렉터리가 정상적으로 표시됩니다.

![07](/Samba%20서버/imgs/07.png)

---

## Linux에서 파일 생성 후 Windows 확인

- Linux에서 파일을 생성합니다.
```
echo test ast10 > /home/data/a.txt
```
![08](/Samba%20서버/imgs/08.png)

- Windows에서 a.txt 파일이 즉시 표시되는 것을 확인합니다.

![09](/Samba%20서버/imgs/09.png)

---

## Windows에서 파일 삭제 및 생성 실습

- Windows에서 a.txt 파일을 삭제합니다.

![10](/Samba%20서버/imgs/10.png)

- Windows에서 새로운 텍스트 파일을 생성하고 내용을 입력합니다.
```
test in window
```
![11](/Samba%20서버/imgs/11.png)  
![12](/Samba%20서버/imgs/12.png)

---

## Linux에서 파일 내용 확인

- Linux에서 파일 내용을 확인합니다.
```
cat /home/data/a.txt
```
![13](/Samba%20서버/imgs/13.png)  

- Windows에서 입력한 내용이 정상적으로 출력됩니다.

---

## 정리

- Samba는 네트워크를 통해 파일 시스템을 공유하는 서비스입니다.
- Linux와 Windows가 동일한 디렉터리를 동시에 사용합니다.
- 파일 변경 사항은 실시간으로 양쪽에 반영됩니다.
- 접근 권한은 Linux 퍼미션과 Samba 설정 중 더 엄격한 기준이 적용됩니다.
- 리소스를 직접 제공하는 서비스이므로 보안 설정이 매우 중요합니다.
