# User & Group Management

**리눅스는 멀티유저 시스템이므로, 사용자(User)와 그룹(Group)을 적절히 생성하고 권한 및 암호 정책을 관리하는 과정이 필수적입니다.**

---

## /etc/passwd 파일 구조 확인

- 리눅스의 모든 계정 기본 정보는 `/etc/passwd` 파일에 저장됩니다. 해당 파일을 통해 시스템에 등록된 계정들을 확인할 수 있습니다.

![01](/User%20&%20Group/imgs/01.png)

- 가장 상단의 **root 계정 정보**를 예시로 한 각 항목의 의미는 다음과 같습니다.

| 순서 | 항목 | 값 | 의미 |
|:---|:---|:---|:---|
| 1 | 사용자 이름 | root | 시스템에서 사용하는 계정의 고유 이름 |
| 2 | 비밀번호 자리 | x | 보안상 실제 비밀번호는 `/etc/shadow`에 암호화되어 저장됨 |
| 3 | UID | 0 | 사용자 식별 번호 (0: root, 1000+: 일반 사용자) |
| 4 | GID | 0 | 사용자가 속한 기본 그룹 ID |
| 5 | 사용자 정보 | root | 사용자에 대한 주석 (이름, 정보 등) |
| 6 | 홈 디렉터리 | /root | 로그인 시 사용자가 위치하게 될 기본 경로 |
| 7 | 로그인 쉘 | /bin/bash | 사용자가 로그인할 때 실행되는 셸 프로그램 |

---

## 사용자 암호 정책 확인 (/etc/shadow)

- 사용자의 암호 해시값과 상세 암호 정책(만료일 등)은 `/etc/shadow` 파일에서 관리됩니다.
- **암호 해시 구조:** `$알고리즘ID$Salt$Hash값` (예: `$6`은 SHA512 알고리즘 사용)
- **주요 필드:** `계정명 : 암호 : 최종변경일 : 암호최소사용일 : 암호최대유효기간 : 경고기간 : 계정폐쇄기간 : 계정만료일`

---

## 그룹 생성 및 관리 (groupadd)

- 그룹을 생성할 때는 `groupadd` 명령어를 사용합니다. 사용자를 등록하기 전, 해당 사용자가 속할 그룹이 먼저 생성되어 있어야 체계적인 관리가 가능합니다.

![02](/User%20&%20Group/imgs/02.png)

- 이미 존재하는 GID번호를 할당하려고 하면 위 사진처럼 `'1001' GID가 이미 있습니다 라고 오류메시지가 출력됩니다.

- **주요 명령어 실행 예시:**
    - `groupadd -g 1001 group1`: GID를 1001로 지정하여 생성
    - `groupadd group2`: GID를 자동 할당 (기존 최대 GID의 다음 번호 할당)
    - `groupadd -r group3`: **시스템 그룹(0~999)** 범위 내에서 번호 할당
    - `groupadd -o -g 1001 group4`: `-o` 옵션을 사용하여 이미 존재하는 **중복 GID** 사용

---

## 사용자 생성 (useradd)

- 사용자를 생성할 때 특정 그룹(`-g`)이나 UID(`-u`)를 지정할 수 있습니다.

![04](/User%20&%20Group/imgs/04.png)

- **주요 옵션 설명:**
    - `-g`: 사용자의 주 그룹(Primary Group)을 지정
    - `-G`: 사용자의 보조 그룹 지정 (사용자는 여러 그룹에 속할 수 있음)
    - `-s`: 기본 쉘 지정 (보안용 계정은 `/sbin/nologin`으로 설정)

---

## 그룹 삭제 (groupdel)

- 그룹삭제는 `groupdel [그룹명]`으로 삭제할 수 있습니다.
- `groupdel group4`로 group4를 제거한 것을 확인할 수 있습니다.

![03](/User%20&%20Group/imgs/03.png)

---

## 사용자 삭제 시 주의사항 (userdel -r)

- 사용자 계정을 삭제할 때는 반드시 `-r` 옵션을 포함하여 홈 디렉터리와 메일함까지 함께 삭제해야 합니다.
- 여기서 st02는 지워진 사용자로 알아 `useradd -g 2000 -u 2001 st02`로 추가한다고 가정해보겠습니다.
- 다음 사진처럼 이미 지웠다고 생각한 유저인 st02를 추가했더니 홈 디렉터리가 이미 있다고 출렵됩니다.  여기서 st02로 유저 추가가 되긴 됩니다.

![05](/User%20&%20Group/imgs/05.png)

- 하지만 st02를 지우려고 할때는 다음과같이 문제가 생깁니다

![06](/User%20&%20Group/imgs/06.png)

- st02를 삭제했다가 UID를 다르게 다시 만들어서 홈 디렉터리의 소유자 UID가 맞지 않아 st02 유저가 삭제되지 않습니다.
- 그러므로 유저 삭제를 할때는 항상 `-r`옵션을 필수로 주는 것을 기억해야합니다.

- **옵션 유무에 따른 차이:**
    - `userdel -r [계정명]`: 계정 정보와 해당 사용자의 **홈 디렉터리까지 모두 삭제**
    - `userdel [계정명]`: 계정은 삭제되지만 **홈 디렉터리 파일은 서버에 잔류**하여 소유권 충돌 문제 발생 가능

---

## 시스템 전용 계정 생성

- 실제 로그인이 필요 없는 서비스용 계정은 홈 디렉터리를 만들지 않거나 쉘 접근을 제한합니다.
![07](/User%20&%20Group/imgs/07.png)

- 위의 사진에서 cat /etc/passwd | grep imsy에 나오지만 ls /home/imsy*에 없는 이유는, 계정 정보는 등록됐지만 `-M`과 `-r` 옵션으로 홈 디렉터리가 실제로 생성되지 않았기 때문입니다.
- 실제로 서비스용·시스템 계정을 만들 때 불필요한 홈 디렉터리나 로그인을 막아 관리와 보안을 단순화하기 위해 `-M, -r, /sbin/nologin`을 사용합니다.
- 하지만 `ls /home/imsy*`를 출력해보면 그런 파일이나 디렉터리가 없습니다 라고 출력됩니다.
- ls /home/imsy*에서 “그런 파일이나 디렉터리가 없다”는 것은 계정은 존재하지만 `-M` 또는 `-r` 옵션 때문에 실제 홈 디렉터리가 생성되지 않았기 때문입니다.

- **주요 관리 옵션:**
    - `-M`: 사용자의 홈 디렉터리를 생성하지 않음
    - `-r`: 999번 이하의 시스템 UID 자동 할당 및 홈 디렉터리 미생성

---

## 사용자 비밀번호 변경

- `passwd [사용자 계정]`로 암호를 변경합니다.

![08](/User%20&%20Group/imgs/08.png)

- `root`로 접근하지 않으면 사용자 계정에 대한 비밀번호 변경이 제한됩니다.
- 따라서 다음사진과 같이 `sudo su`로 root권한에 접근하여 변경해야합니다.

![09](/User%20&%20Group/imgs/09.png)
