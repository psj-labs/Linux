# Slave name server

## 개요

- 본 문서는 Linux 환경에서  
  `BIND(named)`를 이용해 `Master Name Server`와 `Slave Name Server`를 구성하는 실습 내용을 정리한 학습 문서입니다.
- `Master Name Server`에서 `존(zone)` 데이터를 관리하고  
  `Slave Name Server`가 이를 동기화하여 DNS 질의에 응답하는 구조를 확인합니다.
- `also-notify`와 `masters` 설정을 통해  
  존 변경 사항이 Slave 서버에 즉시 반영되는 동작을 확인합니다.

---

## Master Name Server 설정

- `Master Name Server`의 IP 주소는 `192.168.0.129` 입니다.
- `ast10.sec` 도메인의 존 데이터를 직접 관리합니다.

### Master Name Server named.conf 설정

![07](/DNS%20서버/imgs/07.png)

- `ast10.sec` 도메인의 타입을 `master`로 설정합니다.
- 다음 설정을 추가합니다.
```
also-notify { 192.168.0.130; };
```
- also-notify 설정은  
  존(zone) 데이터가 변경될 경우 Slave Name Server에게 즉시 변경 사실을 알리는 역할을 합니다.

---

## Master Name Server 존 파일 설정

![08](/DNS%20서버/imgs/08.png)

- `ns(ast10.sec)`의 IP 주소는 `192.168.0.129`로 설정되어 있습니다.
- `ast10.sec`와 `www.ast10.sec`에 대한 호스트 IP를 `192.168.0.131`로 지정하였습니다.

---

## Master Name Server 데몬 실행

- 다음 명령어로 named 데몬을 실행합니다.
```
systemctl start named
```
![09](/DNS%20서버/imgs/09.png)

- 반드시 다음 명령어로 상태가 `active`인지 확인합니다.
```
systemctl status named
```
---

## Slave Name Server 설정

- `Slave Name Server`의 IP 주소는 `192.168.0.130` 입니다.
- `Master Name Server`인 `192.168.0.129`를 기준으로 존 데이터를 동기화합니다.

### Slave Name Server named.conf 설정

![10](/DNS%20서버/imgs/10.png)

- 다음 설정을 추가합니다.
```
masters { 192.168.0.129; };
```
- masters 설정은  
  `Slave Name Server`가 존 데이터를 가져올 기준 `Master` 서버를 지정하는 설정입니다.

---

## Slave Name Server 존 파일 동기화 확인

- `Slave Name Server`에서는  
  `Master Name Server`의 `ast10.sec.zone` 파일을 직접 생성하지 않습니다.
- named 데몬이 정상적으로 실행되면  
  다음과 같이 존 파일이 자동으로 생성됩니다.

![11](/DNS%20서버/imgs/11.png)

- 해당 파일은 사람이 직접 보기 어렵게 출력됩니다.

![12](/DNS%20서버/imgs/12.png)

- 또한 해당 파일은 읽기 전용 권한으로 생성되며  
  관리자가 직접 수정해서는 안 됩니다.

![15](/DNS%20서버/imgs/15.png)

---

## Master Name Server 동작 확인

- Master Name Server가 정상 동작하는지 확인합니다.
```
nslookup www.google.com 192.168.0.129
```
![13](/DNS%20서버/imgs/13.png)

- `www.google.com`의 IP 주소를  
  `Master Name Server`가 정상적으로 응답하는 것을 확인합니다.
- 이는 `named.ca(root hints)`에  
  전 세계 루트 네임서버 정보가 포함되어 있기 때문입니다.

---

## Slave Name Server 동작 확인

- `Slave Name Server`로 동일한 질의를 수행합니다.
```
nslookup www.google.com 192.168.0.130
```
![14](/DNS%20서버/imgs/14.png)

- `Slave Name Server`는  
  `Master Name Server`로부터 동기화한 존 데이터를 기준으로 응답합니다.

---

## Client에서 Slave Name Server 질의

- DNS 서버가 설치되지 않은 다른 호스트 `192.168.0.128`에서 질의를 수행합니다.
```
nslookup www.google.com 192.168.0.130
```
![16](/DNS%20서버/imgs/16.png)

- `Slave Name Server`가 정상적으로 응답하는 것을 확인합니다.

---

## Slave Name Server 중단 테스트

- Slave Name Server의 named 데몬을 중지합니다.
```
systemctl stop named
```
![17](/DNS%20서버/imgs/17.png)

- 다시 질의를 수행합니다.
```
nslookup www.google.com 192.168.0.130
```
![18](/DNS%20서버/imgs/18.png)

- 응답이 오지 않는 것을 확인합니다.

---

## Slave Name Server 재기동 확인

- named 데몬을 다시 시작합니다.
```
systemctl start named
```
![19](/DNS%20서버/imgs/19.png)

- 다시 질의를 수행합니다.
```
nslookup www.google.com 192.168.0.130
```
![20](/DNS%20서버/imgs/20.png)

- 정상적으로 응답이 오는 것을 확인합니다.

---

## 내부 도메인 질의 확인

- `ast10.sec` 도메인에 대해 질의합니다.
```
nslookup ast10.sec 192.168.0.130
```
![21](/DNS%20서버/imgs/21.png)

- `ast10.sec`의 IP 주소가 `192.168.0.131`로 응답되는 것을 확인합니다.
- 이는 존 파일에 다음과 같이 설정했기 때문입니다.

![22](/DNS%20서버/imgs/22.png)

---

## 용어 정리

- 기술적으로 도메인의 IP라는 표현은 부정확합니다.
- 정확한 표현은  
  도메인에 속한 호스트 이름(A/AAAA 레코드)에 매핑된 IP 주소입니다.

---

## 정리

- `Master Name Server`는 존 데이터를 직접 관리합니다.
- `Slave Name Server`는 `Master`로부터 존 데이터를 동기화합니다.
- `also-notify` 설정을 통해 존 변경 사항을 즉시 전파할 수 있습니다.
- `Slave Name Server`는 장애 대응 및 부하 분산에 활용됩니다.
