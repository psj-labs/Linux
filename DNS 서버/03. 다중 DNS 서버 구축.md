# 다중 DNS 서버 구축

## 실습 환경 구성

![39](/DNS%20서버/imgs/39.png)

- 본 실습은 Linux 환경에서 DNS의 계층 구조를 명확히 이해하기 위해 구성된 실습 환경입니다.
- Root Name Server, TLD Name Server, Sub Domain Name Server, Cache Name Server를 각각 분리하여 구성합니다.
- 각 DNS 서버는 서로 다른 역할을 수행하며, 실제 DNS 질의 흐름을 그대로 재현합니다.

- 실습에 사용된 서버 구성은 다음과 같습니다.
```
Root Name Server  
IP 주소 : 192.168.0.128  
역할 : 루트 존(.) 관리 및 TLD 서버 정보 제공
```
```
TLD Name Server  
IP 주소 : 192.168.0.129  
역할 : sec., itc. 도메인의 권한 네임서버
```
```
Sub Domain Name Server  
IP 주소 : 192.168.0.130  
역할 : ast.sec., ast.itc. 하위 도메인의 권한 네임서버
```
```
Cache Name Server  
IP 주소 : 192.168.0.131  
역할 : 존을 가지지 않고 질의 결과를 캐시하여 응답
```
- 모든 DNS 서버는 BIND(named)를 사용하여 구성합니다.
- 모든 DNS 서버는 동일한 Root Hint 파일 `/var/named/named.ca`을 사용합니다.
- 실습은 재귀 질의 기반으로 동작하며, Cache DNS를 통해 전체 질의 흐름을 검증합니다.

---

## Root Name Server 설정

- 다음은 루트 네임서버의 `/etc/named.conf` 파일입니다.

![23](/DNS%20서버/imgs/23.png)

- 최상위 루트 네임서버이기 때문에  
  존(zone)은 "." 하나만 존재합니다.

---

## Root Name Server 존 파일

![24](/DNS%20서버/imgs/24.png)

- 이 루트 네임서버의 환경은 `192.168.0.128` 입니다.
- TLD 서버에 해당하는 `sec.`와 `itc.` 를  
  서브 도메인으로 위임(delegate)하여 작성하였습니다.

---

## Root Hint 파일

- 루트 힌트 파일의 경로는 `/var/named/named.ca` 입니다.
- 루트 힌트(Root Hint)는  
  DNS 서버가 세상에서 제일 처음 누구에게 물어봐야 하는지를 알려주는 시작 주소록입니다.

![25](/DNS%20서버/imgs/25.png)

- 위 설정의 의미는 다음과 같습니다.
  - `.(루트 존)`은 `a.root-servers.net` 이 관리합니다.
  - `a.root-servers.net` 의 IP 주소는 `192.168.0.128` 입니다.

- 이는 DNS 서버가  
  자기 존에 없는 이름을 질의받았을 때 사용됩니다.
- 자기 존에 없는 질의가 들어오면  
  루트 힌트를 열어 `a.root-servers.net` 의 IP를 확인하고 해당 서버로 질의합니다.
- 루트 힌트는  
  모든 DNS 서버가 공통으로 사용하는 최초 질의 출발점이기 때문에  
  모든 DNS 서버에서 동일해야 합니다.

---

## TLD Name Server 설정

- 다음은 TLD 네임서버의 `/etc/named.conf` 파일입니다.

![26](/DNS%20서버/imgs/26.png)

- 현재 이 서버는 `sec.`와 `itc.` 도메인의  
  최종 책임자(Authoritative)입니다.
- 실제 정답은 `sec.zone`과 `itc.zone` 파일에 직접 보관합니다.

---

## sec.zone 파일

![28](/DNS%20서버/imgs/28.png)

- 이 네임서버의 IP 주소는 `192.168.0.129` 입니다.
- 서브 도메인 `ast.sec` 의 네임서버는 `ns.ast.sec` 입니다.
- `ns.ast.sec` 의 IP 주소는 `192.168.0.130` 입니다.

---

## itc.zone 파일

![27](/DNS%20서버/imgs/27.png)

- 이 네임서버의 IP 주소는 `192.168.0.129`입니다.
- 서브 도메인 `ast.itc` 의 네임서버는 `ns.ast.itc` 입니다.
- `ns.ast.itc` 의 IP 주소는 `192.168.0.130` 입니다.

---

## TLD Name Server Root Hint

![29](/DNS%20서버/imgs/29.png)

- TLD 네임서버의 루트 힌트 파일 역시  
  모든 DNS 서버와 동일한 내용을 사용합니다.

---

## 하위 도메인 Name Server 설정

- 다음은 최종 IP 레코드를 보유한  
  하위 도메인 네임서버의 `/etc/named.conf` 파일입니다.

![30](/DNS%20서버/imgs/30.png)

- 이 서버는 `ast.sec`와 `ast.itc` 도메인의  
  최종 책임자입니다.
- 실제 정답은 `ast.sec.zone`과 `ast.itc.zone` 파일에 직접 보관합니다.

---

## ast.sec.zone 파일

![31](/DNS%20서버/imgs/31.png)

- `ast.sec` 도메인의 네임서버 IP 주소는 `192.168.0.130` 입니다.

---

## ast.itc.zone 파일

![32](/DNS%20서버/imgs/32.png)

- `ast.itc` 도메인의 네임서버 IP 주소는 `192.168.0.130` 입니다.

---

## 하위 도메인 Name Server Root Hint

![33](/DNS%20서버/imgs/33.png)

- 하위 도메인 네임서버 역시  
  동일한 루트 힌트 파일을 사용합니다.

---

## Cache Name Server

![34](/DNS%20서버/imgs/34.png)

- 캐시 네임서버는  
  자기 존을 보유하지 않는 서버입니다.
- 루트 힌트(type hint)만 있으면 됩니다.
- 캐시 DNS의 역할은 하나입니다.

나는 어떤 도메인의 주인도 아니다.  
대신, 물어보면 대신 찾아준다.

---

## Cache DNS 질의 흐름

- nslookup ns.ast.sec

- 질의 처리 과정은 다음과 같습니다.
```
1. 메모리에 캐시가 있는지 확인합니다.
2. 없으면 루트 힌트를 확인합니다.
3. 루트 DNS 서버에 질의합니다.
4. TLD DNS 서버에 질의합니다.
5. Authoritative DNS 서버에 질의합니다.
6. 응답을 캐시에 저장합니다.
7. 클라이언트에게 응답합니다.
```
- 루트 힌트 파일은  
  모든 DNS 서버가 공통으로 사용하는 최초 질의 출발점이므로  
  전부 동일해야 합니다.

![35](/DNS%20서버/imgs/35.png)

---

## Named 데몬 실행 확인

- 모든 DNS 서버에서 named 데몬을 실행합니다.
- status로 정상 동작 여부를 확인합니다.

![36](/DNS%20서버/imgs/36.png)

---

## Cache DNS 질의 테스트

- 캐시 네임서버에서 다음 질의를 수행합니다.
```
nslookup ns.ast.sec 192.168.0.131
```
- 캐시 네임서버는 `루트 네임서버 → TLD → 하위 도메인` 순으로 질의합니다.

![37](/DNS%20서버/imgs/37.png)

- 정상적으로 IP 주소가 응답되는 것을 확인합니다.

---

## 추가 질의 테스트

- ns.ast.itc 도메인도 질의합니다.
```
nslookup ns.ast.itc 192.168.0.131
```
![38](/DNS%20서버/imgs/38.png)

- 정상적으로 응답이 오는 것을 확인합니다.

---

## 정리

- DNS는 계층 구조로 동작합니다.
- `Root → TLD → Sub Domain` 순서로 질의가 전달됩니다.
- Root Hint는 모든 DNS 서버가 공통으로 사용합니다.
- Cache DNS는 질의 결과를 저장하여 성능을 향상시킵니다.
- Authoritative DNS만이 최종 정답을 보유합니다.
