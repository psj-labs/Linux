# NAT 환경 구성 실습 (Rocky Linux 기반)

## 개요

- 본 문서는 Rocky Linux 최소 설치 환경에서  
  **다중 네트워크 구간 간 통신을 위한 NAT / 라우팅 실습**을 정리한 문서입니다.
- Linux → Router → Linux 구조를 구성하여  
  서로 다른 네트워크 대역 간 통신이 가능하도록 설정합니다.
- 방화벽, 커널 포워딩, SELinux, 라우팅 설정을 단계별로 확인합니다.

---

## 네트워크 구성 개요

(사진 추가 예정)

---

## Linux11 네트워크 설정

![04](/NAT%20configuration/imgs/04.png)

- IP 주소 : 192.168.11.11  
- 서브넷 마스크 : 255.255.255.0  
- 게이트웨이 : 192.168.11.1  
- DNS : 8.8.8.8  

---

## Linux12 네트워크 설정

![03](/NAT%20configuration/imgs/03.png)

- IP 주소 : 192.168.12.12  
- 서브넷 마스크 : 255.255.255.0  
- 게이트웨이 : 192.168.12.1  
- DNS : 8.8.8.8  

---

## Router (ens160) 네트워크 설정

![01](/NAT%20configuration/imgs/01.png)

- IP 주소 : 192.168.11.254  
- 서브넷 마스크 : 255.255.255.0  
- 게이트웨이 : 192.168.11.1  
- DNS : 8.8.8.8  

---

## Router (ens224) 네트워크 설정

![02](/NAT%20configuration/imgs/02.png)

- IP 주소 : 192.168.12.1  
- 서브넷 마스크 : 255.255.255.0  
- 게이트웨이 : 없음  
- DNS : 없음  

---

## 사전 환경 설정

- 본 실습은 **최소 설치(minimal install)** 환경에서 진행합니다.
- 실습의 편의를 위해 방화벽과 보안 정책을 비활성화합니다.

---

## firewalld 비활성화
```text
systemctl disable firewalld.service  
systemctl stop firewalld.service  
```
![07](/NAT%20configuration/imgs/07.png)

- 위 두 명령어는 다음을 의미합니다.
  - 현재 실행 중인 firewalld 서비스를 중지합니다.
  - 시스템 재부팅 후에도 firewalld가 자동으로 실행되지 않도록 설정합니다.

---

## IP 포워딩 활성화

- Router 역할을 수행하기 위해 커널 IP 포워딩을 활성화합니다.
- `/etc/sysctl.conf` 파일에 다음 항목을 추가합니다.

net.ipv4.ip_forward=1  

![08](/NAT%20configuration/imgs/08.png)

- 이 설정은 해당 Linux 시스템이 받은 패킷을 다른 네트워크로 전달하도록 허용합니다.

---

## 커널 설정 즉시 적용
```text
sysctl -p  
```
![09](/NAT%20configuration/imgs/09.png)

- `/etc/sysctl.conf`에 설정한 커널 옵션을  
  재부팅 없이 즉시 적용합니다.

---

## SELinux 비활성화

- `/etc/selinux/config` 파일을 수정합니다.
```text
SELINUX=disabled  
```
![05](/NAT%20configuration/imgs/05.png)

- SELinux를 완전히 비활성화하여  
  커널 보안 정책으로 인한 통신 차단을 제거합니다.
- 해당 설정은 **재부팅 후 적용**됩니다.

---

## Windows (192.168.10.146) 라우팅 추가

- Windows PC에서  
  192.168.12.0/24 네트워크로 통신 가능하도록  
  라우팅 경로를 수동으로 추가합니다.
```text
route -p add 192.168.12.0 MASK 255.255.255.0 192.168.11.254  
```
![10](/NAT%20configuration/imgs/10.png)

- -p 옵션의 의미
  - 시스템 재부팅 후에도 라우팅 정보를 유지합니다.

---

## Linux11 → Linux12 라우팅 추가

- Linux11에서 Linux12 네트워크로 통신 가능하도록 라우팅을 추가합니다.
```text
ip route add 192.168.12.0/24 via 192.168.11.254 dev ens160  
```
![11](/NAT%20configuration/imgs/11.png)

- ip route 확인 시  
  192.168.12.0/24 네트워크로 가는 경로가 정상적으로 추가된 것을 확인할 수 있습니다.

---

## 인터페이스 및 IP 상태 확인

### Linux11

![14](/NAT%20configuration/imgs/14.png)

### Router

![13](/NAT%20configuration/imgs/13.png)

### Linux12

![15](/NAT%20configuration/imgs/15.png)

- 각 시스템의 인터페이스와 IP 상태가 정상임을 확인합니다.

---

## 통신 테스트

- Windows (192.168.10.146)에서  
  Linux12 (192.168.12.12)로 ping 테스트를 수행합니다.
```text
ping 192.168.12.12  
```
![12](/NAT%20configuration/imgs/12.png)

- 정상적으로 응답이 수신되는 것을 확인할 수 있습니다.

---

## 정리

- Router Linux에서
  - IP 포워딩 활성화
  - 방화벽 및 SELinux 비활성화
  를 통해 라우터 역할을 수행하도록 구성하였습니다.
- Windows, Linux11에 라우팅 경로를 추가하여
  서로 다른 네트워크 대역 간 통신이 가능하도록 설정하였습니다.
- 최종적으로 NAT 및 라우팅 기반 실습 환경이 정상적으로 구축되었습니다.
