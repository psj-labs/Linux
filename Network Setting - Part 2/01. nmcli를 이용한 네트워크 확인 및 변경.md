# nmcli를 이용한 네트워크 확인 및 변경

## 개요

- Linux에서 네트워크를 관리하는 명령어는 `ip` 외에도 `ifconfig`, `nmcli` 등 다양한 도구가 존재합니다.
- 각 도구는 **관리 방식과 설정 지속성(임시 / 영구)** 에 차이가 있습니다.
- 본 문서는 nmcli를 중심으로 device / connection 개념과 동작 방식을 정리합니다.

---

## 네트워크 관리 도구 비교

- nmcli
  - NetworkManager 기반 도구입니다.
  - **프로파일(connection)** 을 수정하거나 조회합니다.
  - 설정 변경 시 실제 NIC 또는 네트워크 재적용이 필요합니다.
  - 기본적으로 RockyLinux에 설치되어 있습니다.

- ifconfig
  - Linux 외 대부분의 Unix 계열과 명령어 호환이 됩니다.
  - 최신 Linux에서는 기본 제거되어 있는 경우가 많습니다.
  - 사용하려면 `net-tools` 패키지 설치가 필요할 수 있습니다.

- ip / ifconfig 공통점
  - 현재 동작 중인 상태를 수정합니다.
  - **영구 설정이 아니며**, 재부팅 시 설정이 사라집니다.

---

## nmcli 구성 요소 개념

- device
  - 실제 하드웨어 네트워크 인터페이스
  - 예: ens160, ens224

- connection
  - 네트워크 연결 프로파일
  - 설정 파일 자체를 의미합니다.
  - device에 적용되어 동작합니다.

- OS 설치 후 추가된 NIC는
  - device 이름과 connection 이름이 다를 수 있습니다.

---

## NetworkManager 설정 파일 경로

### `/etc/sysconfig/network-scripts/ifcfg-[NIC]`

- legacy network-scripts 방식 설정 파일입니다.
- RockyLinux 8까지 하위 호환을 위해 사용됩니다.
- 레거시 포맷이며 우선순위는 낮지만 발견 시 사용됩니다.

### `/etc/NetworkManager/system-connections/[NIC].nmconnection`

- NetworkManager 전용 프로파일 파일입니다.
- RockyLinux 9부터 기본 방식으로 사용됩니다.

---

## nmcli 기본 명령 구조
```text
nmcli [옵션] <object> <command> [arguments]
```
### object 종류

- connection : 네트워크 연결(프로파일) 관리
- device : 실제 네트워크 장치 관리
- general : NetworkManager 전반 상태
- networking : 네트워크 기능 전체 on/off
- radio : Wi-Fi, WWAN 제어
- agent : 인증 처리
- monitor : 상태 변화 실시간 감시

### command 예시
```text
status, show, up, down, on, off, modify, add, delete
```
- nmcli 명령어 역시 축약 사용이 가능합니다.

---

## nmcli 주요 옵션

- -t : 간결한 출력 (terse)
- -p : 사람이 읽기 좋은 출력 (pretty)
- -f : 출력 필드 지정
- -g : 특정 필드만 출력
- -w <초> : 대기 시간 설정
- -a : 상호작용 모드

---

## 기본 정보 확인

### connection 목록 확인
```text
nmcli c  
또는  
nmcli c show
```
![01](/Network%20Setting%20-%20Part%202/imgs/01.png)

- 출력 정보
  - NAME
  - UUID
  - TYPE
  - DEVICE

---

### device 목록 확인
```text
nmcli d
```
![02](/Network%20Setting%20-%20Part%202/imgs/02.png)

- 출력 정보
  - DEVICE
  - TYPE
  - STATE
  - CONNECTION

---

### device 상세 정보 확인
```text
nmcli d show ens224
```
![03](/Network%20Setting%20-%20Part%202/imgs/03.png)

---

## nmcli d 와 nmcli d show 차이

- `nmcli d`
  - 장치 목록 요약 출력
  - 여러 device를 한 줄씩 간단히 보여줍니다.
  - 관리 상태를 빠르게 확인하는 용도입니다.

- `nmcli d show`
  - **특정 device의 상세 정보 출력**
  - 실제 인터페이스에 **현재 적용 중인 런타임 상태**를 보여줍니다.
  - IP, Gateway, DNS, MTU 등 세부 정보 확인용입니다.

### `정리`
nmcli d는 목록 요약, nmcli d show는 현재 적용된 실제 상태를 상세히 보여줍니다.

---

## IP / Gateway / DNS 확인
```text
nmcli d show ens224 | grep IP4.ADDRESS  
nmcli d show ens224 | grep IP4.GATEWAY  
nmcli d show ens224 | grep IP4.DNS  
```
![05](/Network%20Setting%20-%20Part%202/imgs/05.png)

---

## IP 주소 변경 (영구 설정)
```text
nmcli c mod ens224 ipv4.addresses 192.168.11.66/24
```
- 이 동작은 **설정 파일을 수정하는 영구 변경**입니다.

---

## 변경 직후 상태 확인
```text
nmcli d show ens224 | grep IP4.ADDRESS
```
![06](/Network%20Setting%20-%20Part%202/imgs/06.png)

- 여전히 이전 IP가 보입니다.
### `이유`
  - nmcli d show는 **현재 세션에 적용된 상태**를 보여주기 때문입니다.

---

## 영구 설정 파일 확인
```text
cat /etc/sysconfig/network-scripts/ifcfg-ens224 | grep IPADDR
```
- 설정 파일에는 변경된 IP가 정상적으로 저장되어 있습니다.

---

## 설정 적용 방법

- 방법 1 : 시스템 재부팅
- 방법 2 : connection 재적용
```text
nmcli c up ens224
```
---

## 적용 후 확인
```text
nmcli d show ens224 | grep IP4.ADDRESS
```
![07](/Network%20Setting%20-%20Part%202/imgs/07.png)

- 변경된 IP가 실제로 적용된 것을 확인할 수 있습니다.

---

## connection 기준 확인
```text
nmcli c show ens224 | grep -e IP4.ADDRESS -e ipv4.adress
```
![08](/Network%20Setting%20-%20Part%202/imgs/08.png)

- connection에 저장된 **영구 설정값**을 확인합니다.

---

## Gateway / DNS 변경

### 변경 전 상태 확인
```text
cat /etc/sysconfig/network-scripts/ifcfg-ens224 | grep -e GATEWAY -e DNS
```
![09](/Network%20Setting%20-%20Part%202/imgs/09.png)

- Gateway : 192.168.11.1
- DNS : 8.8.8.8

---

### 설정 변경
```text
nmcli c mod ens160 ipv4.gateway 192.168.10.254 ipv4.dns 1.1.1.1
```
---

### 설정 파일 확인

![10](/Network%20Setting%20-%20Part%202/imgs/10.png)

- 영구 설정 파일에는 정상 반영되어 있습니다.

---

### 현재 상태 확인 (아직 미적용)
```text
nmcli d show ens160 | grep -e IP4.GATEWAY -e IP4.DNS
```
![11](/Network%20Setting%20-%20Part%202/imgs/11.png)

- 이유
  - nmcli d는 현재 동작 중인 상태만 출력합니다.

---

### 설정 적용
```text
nmcli c up ens160
```
![12](/Network%20Setting%20-%20Part%202/imgs/12.png)

- Gateway 및 DNS가 정상적으로 적용된 것을 확인할 수 있습니다.

---

## 정리

- `ip / ifconfig`
  - 즉시 적용되지만 임시 설정입니다.
- `nmcli`
  - 설정 파일을 수정하는 영구 설정 도구입니다.
- `nmcli c show`
  - 저장된 설정값 확인
- `nmcli d show`
  - 현재 동작 중인 실제 상태 확인
- 설정 변경 후에는 반드시
  - `nmcli c up [connection]`
  - 또는 재부팅이 필요합니다.
