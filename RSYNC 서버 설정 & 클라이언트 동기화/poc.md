# RSYNC 서버 설정 & 클라이언트 동기화

## 개요

- 본 문서는 Linux 환경에서 rsync를 이용하여  
  두 시스템 간 디렉토리를 동기화하는 과정을 정리한 학습 문서입니다.
- 원본 저장 시스템과 백업본 저장 시스템을 분리하여  
  rsync 서버와 rsync 클라이언트 구조로 구성합니다.
- rsync 서버 설정, 동기화 실습, cron을 이용한 자동 백업까지 함께 정리합니다.

---

## 실습 환경 구성

- 원본 저장 시스템  
  rsync server  
  IP : 192.168.10.147

- 백업본 저장 시스템  
  rsync client  
  IP : 192.168.10.146

- 두 시스템 간에 지정한 디렉토리를 동기화합니다.
- 일반적으로 원본 저장 시스템을 `rsync 서버`로 구성합니다.

---

## rsync 설치 여부 확인

- 다음 명령어로 rsync 설치 여부를 확인합니다.
```text
dnf list rsync*
```
![01](/RSYNC%20서버%20설정%20&%20클라이언트%20동기화/imgs/01.png)

- rsync 패키지가 설치된 것을 확인할 수 있습니다.

---

## 원본 저장 시스템 디렉토리 준비

- 원본 저장 시스템에서 백업 대상 디렉토리를 생성합니다.
```text
mkdir /backup
cd /backup
echo 11 > a.txt
echo 22 > b.txt
```
![02](/RSYNC%20서버%20설정%20&%20클라이언트%20동기화/imgs/02.png)

- 동기화 테스트를 위해 `a.txt`와 `b.txt` 파일을 생성합니다.

---

## rsync 서버 설정 파일 작성

- rsync 서버 설정 파일은 다음 경로에 위치합니다.
```text
/etc/rsyncd.conf
```
- vi 편집기로 다음 항목을 작성합니다.

![03](/RSYNC%20서버%20설정%20&%20클라이언트%20동기화/imgs/03.png)

---

## rsyncd.conf 설정 항목 설명

- 각 항목의 의미는 다음과 같습니다.
```text
[서비스명]  
리소스 식별자이며 클라이언트에서 사용합니다.
```
```text
path  
백업 대상 디렉토리 경로입니다.
```
```text
comment  
설명용 주석입니다.
```
```text
uid  
파일 전송 시 사용할 UID입니다.
```
```text
gid  
파일 전송 시 사용할 GID입니다.
```
```text
use chroot  
rsync 경로를 외부에서 루트 디렉토리로 인식합니다.
```
```text
read only  
읽기 전용 접근 여부를 설정합니다.
```
```text
hosts allow  
접속을 허용할 클라이언트 IP를 지정합니다.
```
```text
max connections  
동시 접속자 수를 제한합니다.
```
```text
timeout  
접속 유지 시간 제한입니다.
```
---

## rsync 서버 실행 및 상태 확인

- 다음 명령어로 rsync 서버를 실행합니다.
```text
systemctl start rsyncd.service
```
- 서비스 상태를 확인합니다.
```text
systemctl status rsyncd.service
```
![04](/RSYNC%20서버%20설정%20&%20클라이언트%20동기화/imgs/04.png)

- rsync 서버가 정상적으로 실행 중인 것을 확인할 수 있습니다.

---

## rsync 동기화 명령어 개요

- rsync는 서버와 클라이언트 간 디렉토리를 동기화하는 명령어입니다.
```text
[일반 형식]  
rsync -avuz source destination
```
```text
서버 → 클라이언트  
rsync -avuz IP::서비스명 백업디렉토리
```
```text
클라이언트 → 서버  
rsync -avuz 백업디렉토리 IP::서비스명
```
---

## rsync 옵션 설명

- 주요 옵션은 다음과 같습니다.
```text
- v  
작업 내역을 출력합니다.

- a  
archive 모드로 권한, 소유자, 심볼릭 링크를 보존합니다.

- z  
파일을 압축하여 전송합니다.

- u  
최신 파일은 복사하지 않습니다.

--delete  
원본에서 삭제된 파일을 대상에서도 삭제합니다.
```
---

## 클라이언트 동기화 준비

- 동기화를 위해 클라이언트 시스템에 디렉토리를 생성합니다.
```text
mkdir /backup
```
- 백업 파일이 저장될 위치입니다.

---

## rsync 동기화 실행

- 다음 명령어로 서버의 데이터를 클라이언트로 동기화합니다.
```text
rsync -avuz 192.168.10.147::backup /backup
```
![05](/RSYNC%20서버%20설정%20&%20클라이언트%20동기화/imgs/05.png)

- 서버에 존재하는 `a.txt`와 `b.txt` 파일이 정상적으로 전송됩니다.

---

## 동기화 결과 확인

- 클라이언트 시스템에서 파일을 확인합니다.

![06](/RSYNC%20서버%20설정%20&%20클라이언트%20동기화/imgs/06.png)

- 서버와 동일한 파일이 생성된 것을 확인할 수 있습니다.

---

## Cron을 이용한 rsync 자동화

- rsync 명령어를 cron에 등록하여 자동 백업이 가능합니다.
- 매일 새벽 1시에 백업을 수행하도록 설정합니다.
```text
00 01 * * * rsync -avuz 192.168.10.31::backup /backup
```
- 정기적인 자동 백업 환경을 구성할 수 있습니다.

---

## 정리

- rsync는 파일 단위 동기화 및 백업에 특화된 도구입니다.
- 서버와 클라이언트 구조로 안정적인 백업 환경을 구성할 수 있습니다.
- --delete 옵션을 이용하면 완전 동기화가 가능합니다.
- cron과 함께 사용하면 자동 백업 시스템을 구축할 수 있습니다.
- 실무 환경에서 매우 많이 사용되는 백업 방식입니다.
