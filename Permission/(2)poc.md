# SUID(4) / SGID(2) / Sticky Bit(1)

- **리눅스는 기본 권한(rwx) 외에도 특수 권한(Special Permission)을 통해 실행, 공유, 삭제 동작을 추가로 제어합니다.**

---

## SUID (Set User ID) = 4

- SUID가 설정된 **실행 파일**을 실행하면
- 실행한 사용자가 아니라 **파일의 소유자(User) 권한으로 실행**됩니다.
- 실행 중인 프로세스의 **EUID(Effective UID)**가 파일 소유자로 설정됩니다.

---

### 일반적인 실행 상황 (SUID 없음)

- UID  = 로그인한 사용자
- EUID = 로그인한 사용자

-> 이 경우 프로그램은 **실행한 사용자 권한으로만** 동작합니다.

---

### SUID가 설정된 파일 실행 시

- UID  = 실행한 사용자
- **EUID = 파일 소유자**

-> **권한 판단은 파일 소유자 기준으로 이루어집니다.**

---

### 예시

- 파일 경로 : `/usr/bin/passwd`
- 소유자 : `root`
- 권한 : `-rwsr-xr-x`

일반 사용자가 passwd를 실행하면

- UID  = 일반 사용자
- **EUID = root**

-> 그래서 일반 사용자도 `/etc/shadow` (root만 수정 가능한 파일)를 정상적으로 수정할 수 있습니다.

---

### 결과

- SUID 없음 -> `Permission denied`
- SUID 있음 -> `정상 실행`

---

### 확인 방법
- `ls -l` 출력에서 **User 실행 위치**가 s 또는 S로 표시됨  
```text
Ex) -rwsr-xr-x
```
---

### 설정 방법
```text
숫자 방식 : chmod 4755 [파일명]
기호 방식 : chmod u+s [파일명]
```
---

## SGID (Set Group ID) = 2

### 개념 정의
- SGID가 설정된 **실행 파일**을 실행하면 실행한 사용자의 그룹이 아니라 **파일의 그룹 권한으로 실행**됩니다.
- SGID가 설정된 **디렉토리**에서는 해당 디렉토리 안에서 생성되는 모든 파일과 디렉토리가 **부모 디렉토리의 그룹을 상속**합니다.
- 실행 중인 프로세스의 **EGID(Effective GID)**가 파일 그룹으로 설정됩니다.
- SGID는 실행 파일보다 디렉토리에서 훨씬 더 자주 사용됩니다.

---

### 일반적인 실행 상황 (SGID 없음)

- GID  = 사용자 기본 그룹
- EGID = 사용자 기본 그룹

-> 이 경우 프로그램은 **사용자의 그룹 권한으로만** 동작합니다.

---

### SGID가 설정된 파일 실행 시

- GID  = 사용자 기본 그룹
- **EGID = 파일의 그룹**

-> **그룹 권한 판단은 파일 그룹 기준으로 이루어집니다.**

---

### 실제 예시

- 협업 디렉토리 : `/shared/project`
- 그룹 : `st`
- 권한 : `drwxr-sr-x`

-> 누가 파일을 생성하더라도 생성된 파일의 그룹은 항상 st으로 설정됩니다.

---

### 결과

- SGID 없음 -> 파일마다 그룹이 제각각
- SGID 있음 -> 그룹 자동 통일

---

### 확인 방법
- `ls -l` 출력에서 **Group 실행 위치**가 s 또는 S로 표시됨  
```text
Ex) drwxr-sr-x
```
---

### 설정 방법
```text
숫자 방식 : chmod 2755 [파일명]
기호 방식 : chmod g+s [파일명]
```
---

## Sticky Bit = 1

### 개념 정의
- Sticky Bit이 설정된 **디렉토리**에서는 디렉토리에 쓰기 권한이 있어도 **본인 소유 파일만 삭제 가능**하도록 제한됩니다.

---

### 일반적인 디렉토리(Sticky Bit 없음)

- 디렉토리에 쓰기 권한이 있으면 **다른 사용자의 파일도 삭제 가능**

---

### Sticky Bit이 설정된 디렉토리

- 디렉토리에 쓰기 권한이 있어도 **본인 소유 파일만 삭제 가능**
- root만 예외적으로 모든 파일 삭제 가능

---

### 실제 예시

- 디렉토리 : `/tmp`
- 권한 : `drwxrwxrwt`

- 모든 사용자가 파일을 생성할 수 있지만 **자신이 만든 파일만 삭제할 수 있습니다.**

---

### 결과

- Sticky Bit 없음 -> 공용 디렉토리에서 파일 삭제 사고 발생
- Sticky Bit 있음 -> 사용자 간 파일 보호

---

### 확인 방법
- `ls -l` 출력에서 **Others 실행 위치**가 t 또는 T로 표시됨
```text
Ex) drwxrwxrwt
```
---

### 설정 방법
```text
숫자 방식 : `chmod 1777 dirname`
기호 방식 : `chmod +t dirname`
```
---

## 특수 권한 숫자 조합 정리

- 특수 권한은 일반 권한 앞에 **한자리**로 추가됩니다.

- 4xxx : SUID
- 2xxx : SGID
- 1xxx : Sticky Bit

### 예시
- `chmod 4755 file`
- `chmod 2755 dir`
- `chmod 1777 dir`
- `chmod 6755 file`

---


## lsattr

- lsattr은 각 파일들의 **파일 시스템 속성**을 확인하는 명령어입니다.
- 다음 사진처럼 파일 이름 앞에 `-`만 나열되어 있으면 **해당 파일에 설정된 특수 속성이 하나도 없다는 의미**입니다.

![18](/Permission/imgs/18.png)

---

## 주요 파일 속성 정리

| 속성 | 이름(의미) | 설명 |
|:---:|:---|:---|
| **a** | Append only | 추가 모드로만 오픈 가능<br>기존 내용 수정·삭제 불가, root만 속성 변경 가능 |
| **i** | Immutable | 변경·삭제·이름 변경·링크 생성 모두 금지 |
| **A** | No atime update | 파일 접근 시 atime(접근 시간) 갱신 금지 |
| **d** | No dump | dump 명령을 이용한 백업 대상에서 제외 |
| **S** | Synchronous update | 파일 수정 시 디스크에 즉시 동기화 |
| **D** | Synchronous directory update | 디렉토리 변경 사항을 실시간으로 디스크에 동기화 |

---

## chattr

- chattr은 파일의 **속성을 변경**하는 명령어입니다. 사용 형태는 다음과 같습니다

```text
chattr [속성 연산] [옵션] [대상]
```
### 속성 연산
- `+` : 속성 추가
- `-` : 속성 삭제
- `=` : 해당 속성만 설정 (이외 속성 제거)

### 옵션
- `-R` : 하위 모든 파일에 재귀 적용

---

## chattr i 옵션

- a.txt 파일에 `i` 옵션을 적용하여 **변경, 삭제, 링크를 금지**합니다. 사용 형태는 다음과 같습니다.

```text
chattr =i a.txt
```
![19](/Permission/imgs/19.png)

- 위 사진처럼 `i` 옵션이 설정된 상태에서 `rm -rf a.txt`를 실행하면 **파일 삭제가 허용되지 않는 것을 확인**할 수 있습니다.
